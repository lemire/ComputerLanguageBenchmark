<!DOCTYPE html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="robots" content="noindex,follow,noarchive">

<title>meteor-contest C++ g++&nbsp;#6 program | Computer Language Benchmarks Game </title>
<style><!--
a{color:black;text-decoration:none}article{padding: 0 0 2.9em}article,div,footer,header{margin:auto;width:92%}body{font:100% Droid Sans,Ubuntu,Verdana,sans-serif;margin:0;-webkit-text-size-adjust:100%}h1,h2,h3,li a{font-family:Ubuntu Mono,Consolas,Menlo,monospace}div,footer,header{max-width:31em}footer{padding:2.6em 0 0}h1{font-size:1.4em;font-weight:bold;margin:0;padding:.4em}h1,h1 a{color:white}h2,h3{margin:1.5em 0 0}h2{font-size:1.4em;font-weight:normal}h3{font-size:1.2em}li{list-style-type:none;vertical-align:top}li a{display:block;font-size:1.2em;margin:.5em .5em 0;padding:.5em .5em .3em}ul{clear:left;margin:-0.3em 0 1.5em;padding-left:0;text-align:center}p{color:#333;line-height:1.4;margin:.3em 0 0}p a,a span{border-bottom:.1em solid #333;padding-bottom:.1em}#u64,#u64q{background-color:#c90016}#u32{background-color:#ffb515}#u32q{background-color:#ff6309}.com,.slc{color:#888}.kwa{color:#066}.kwb{color:#900}.kwc{color:#050}.kwa,.kwb,.kwc{font-weight:bold}.dstr,.str,.sym,.num{color:#930}pre{color:#222;font-size:1em;overflow-wrap:break-word;white-space:pre-wrap;word-wrap:break-word}@media only screen and (min-width:60em){article,footer,header{font-size:1.25em}}
--></style>
<link rel="shortcut icon" href="./favicon.ico">
<header id="top">
  <h1 id="u64q"><a href="./index.html">The&nbsp;Computer&nbsp;Language<br>Benchmarks&nbsp;Game</a></h1>
</header>
<article>
  <div>
    <h2>meteor-contest C++ g++&nbsp;#6 program</h2>
    <aside>
      <p><a href="./meteor-description.html#meteor">description</a>
    </aside>
  </div>
  <section>
    </div>
      <h3>source code</h3>
    </div>
    <pre>
<span class="com">/* The Computer Language Benchmarks Game</span>
<span class="com">   http://benchmarksgame.alioth.debian.org/</span>
<span class="com"></span>
<span class="com">   contributed by Stefan Westen</span>
<span class="com"></span>
<span class="com">   loosely based on Ben St. John&apos;s and Kevin Barnes&apos; implementation</span>
<span class="com"></span>
<span class="com">   Main improvements:</span>
<span class="com">      - Check for isolated cells instead of bad islands</span>
<span class="com">      - Pre-calculate lists based on availability of 3 neighbouring cells</span>
<span class="com">      - OpenMP tasks</span>
<span class="com">*/</span>

<span class="ppc">#include &lt;stdio.h&gt;</span>
<span class="ppc">#include &lt;omp.h&gt;</span>

<span class="kwb">const int</span> nPieceCount <span class="opt">=</span> <span class="num">10</span><span class="opt">;</span>
<span class="kwb">const int</span> pieces<span class="opt">[</span><span class="num">10</span><span class="opt">][</span><span class="num">5</span><span class="opt">][</span><span class="num">2</span><span class="opt">]  = {</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">2</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">3</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">3</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {-</span><span class="num">2</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}, {-</span><span class="num">3</span><span class="opt">,</span> <span class="num">3</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">2</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">2</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {-</span><span class="num">2</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">3</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">2</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}, {</span><span class="num">1</span><span class="opt">,</span> <span class="num">3</span><span class="opt">}},</span>
   <span class="opt">{{</span><span class="num">0</span><span class="opt">,</span> <span class="num">0</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">1</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">2</span><span class="opt">}, {-</span><span class="num">1</span><span class="opt">,</span> <span class="num">3</span><span class="opt">}, {</span><span class="num">0</span><span class="opt">,</span> <span class="num">3</span><span class="opt">}}</span>
   <span class="opt">};</span>

<span class="kwb">unsigned int</span> g_AllMasks<span class="opt">[</span><span class="num">8192</span><span class="opt">];</span>
<span class="kwb">unsigned int</span> <span class="opt">*</span>g_MaskStart<span class="opt">[</span><span class="num">50</span><span class="opt">][</span><span class="num">8</span><span class="opt">];</span>

<span class="kwb">unsigned char</span> g_min_solution<span class="opt">[</span><span class="num">50</span><span class="opt">],</span> g_max_solution<span class="opt">[</span><span class="num">50</span><span class="opt">];</span>
<span class="kwb">unsigned int</span> g_solutions<span class="opt">;</span>

<span class="kwb">unsigned int</span> EvenRowsLookup<span class="opt">[</span><span class="num">50</span><span class="opt">];</span>
<span class="kwb">unsigned int</span> LeftBorderLookup<span class="opt">[</span><span class="num">50</span><span class="opt">];</span>
   
<span class="kwb">bool</span> <span class="kwd">GoodPiece</span><span class="opt">(</span><span class="kwb">unsigned int</span> mask<span class="opt">,</span> <span class="kwb">unsigned int</span> pos<span class="opt">)</span>
<span class="opt">{</span>
   <span class="kwb">bool</span> <span class="kwd">bOK</span><span class="opt">(</span><span class="kwa">true</span><span class="opt">);</span>
   <span class="kwb">const unsigned long long</span> even_rows <span class="opt">=</span> <span class="num">0xf07c1f07c1f07c1f</span><span class="opt">;</span>
   <span class="kwb">const unsigned long long</span> odd_rows <span class="opt">= ~</span>even_rows<span class="opt">;</span>   
   <span class="kwb">const unsigned long long</span> left_border <span class="opt">=</span> <span class="num">0x1084210842108421</span><span class="opt">;</span>
   <span class="kwb">const unsigned long long</span> right_border <span class="opt">=</span> left_border <span class="opt">&gt;&gt;</span> <span class="num">1</span><span class="opt">;</span>
   <span class="kwb">unsigned long long</span> a<span class="opt">,</span>b<span class="opt">,</span>a_old<span class="opt">,</span>s1<span class="opt">,</span>s2<span class="opt">,</span>s3<span class="opt">,</span>s4<span class="opt">,</span>s5<span class="opt">,</span>s6<span class="opt">,</span>s7<span class="opt">,</span>s8<span class="opt">;</span>
   
   b <span class="opt">= (((</span><span class="kwb">unsigned long long</span><span class="opt">)</span>mask<span class="opt">) &lt;&lt;</span> pos<span class="opt">) |</span> <span class="num">0xFFFC000000000000</span>ULL<span class="opt">;</span>
   
   b <span class="opt">= ~</span>b<span class="opt">;</span>

   <span class="kwa">while</span> <span class="opt">(</span>b<span class="opt">)</span>
   <span class="opt">{</span>
      a <span class="opt">=</span> b<span class="opt">&amp;-</span>b<span class="opt">;</span>

      <span class="kwa">do</span> 
      <span class="opt">{</span>
         s1 <span class="opt">=</span> a <span class="opt">&lt;&lt;</span> <span class="num">5</span><span class="opt">;</span>
         s2 <span class="opt">=</span> a <span class="opt">&gt;&gt;</span> <span class="num">5</span><span class="opt">;</span>
         s3 <span class="opt">= (</span>a <span class="opt">&lt;&lt;</span> <span class="num">1</span><span class="opt">)&amp;(~</span>left_border<span class="opt">);</span>
         s4 <span class="opt">= (</span>a <span class="opt">&gt;&gt;</span> <span class="num">1</span><span class="opt">)&amp;(~</span>right_border<span class="opt">);</span>
         s5 <span class="opt">= ((</span>a <span class="opt">&amp;</span> even_rows<span class="opt">) &gt;&gt;</span> <span class="num">6</span><span class="opt">) &amp;(~</span>right_border<span class="opt">);</span>
         s6 <span class="opt">= ((</span>a <span class="opt">&amp;</span> even_rows<span class="opt">) &lt;&lt;</span> <span class="num">4</span><span class="opt">) &amp;(~</span>right_border<span class="opt">);</span>
         s7 <span class="opt">= ((</span>a <span class="opt">&amp;</span> odd_rows<span class="opt">) &gt;&gt;</span> <span class="num">4</span><span class="opt">) &amp; (~</span>left_border<span class="opt">);</span>
         s8 <span class="opt">= ((</span>a <span class="opt">&amp;</span> odd_rows<span class="opt">) &lt;&lt;</span> <span class="num">6</span><span class="opt">) &amp;(~</span>left_border<span class="opt">);</span>
         a_old <span class="opt">=</span> a<span class="opt">;</span>
         a <span class="opt">= (</span>a<span class="opt">|</span>s1<span class="opt">|</span>s2<span class="opt">|</span>s3<span class="opt">|</span>s4<span class="opt">|</span>s5<span class="opt">|</span>s6<span class="opt">|</span>s7<span class="opt">|</span>s8<span class="opt">)&amp;</span>b<span class="opt">;</span>
      <span class="opt">}</span> <span class="kwa">while</span> <span class="opt">(</span>a_old<span class="opt">!=</span>a<span class="opt">);</span>
      <span class="kwa">if</span> <span class="opt">(</span><span class="kwd">__builtin_popcountll</span><span class="opt">(</span>a<span class="opt">)%</span><span class="num">5</span><span class="opt">!=</span><span class="num">0</span><span class="opt">)</span>
      <span class="opt">{</span>
         bOK <span class="opt">=</span> <span class="kwa">false</span><span class="opt">;</span>
         <span class="kwa">break</span><span class="opt">;</span>
      <span class="opt">}</span>
      b <span class="opt">=</span> b <span class="opt">^</span> a<span class="opt">;</span>
   <span class="opt">}</span>
   <span class="kwa">return</span> bOK<span class="opt">;</span>
<span class="opt">}</span>

<span class="kwb">void</span> <span class="kwd">Initialise</span><span class="opt">()</span>
<span class="opt">{</span>   
   <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>i<span class="opt">++)</span>
   <span class="opt">{</span>
      EvenRowsLookup<span class="opt">[</span>i<span class="opt">] =</span> <span class="num">0xF07C1F07C1F07C1F</span>ULL <span class="opt">&gt;&gt;</span> i<span class="opt">;</span>
      LeftBorderLookup<span class="opt">[</span>i<span class="opt">] =</span> <span class="num">0x1084210842108421</span>ULL <span class="opt">&gt;&gt;</span> i<span class="opt">;</span>
   <span class="opt">}</span>
   
   <span class="kwb">int</span> <span class="kwd">nTotalCount</span><span class="opt">(</span><span class="num">0</span><span class="opt">);</span>
   <span class="kwb">int</span> x<span class="opt">[</span><span class="num">5</span><span class="opt">],</span> y<span class="opt">[</span><span class="num">5</span><span class="opt">];</span>
   <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> nYBase<span class="opt">=</span><span class="num">2</span><span class="opt">;</span>nYBase<span class="opt">&lt;</span><span class="num">4</span><span class="opt">;</span>nYBase<span class="opt">++)</span>
   <span class="opt">{</span>
      <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> nXBase<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>nXBase<span class="opt">&lt;</span><span class="num">5</span><span class="opt">;</span>nXBase<span class="opt">++)</span>
      <span class="opt">{</span>
         <span class="kwb">int</span> nPos <span class="opt">=</span> nXBase<span class="opt">+</span><span class="num">5</span><span class="opt">*</span>nYBase<span class="opt">;</span>
         g_MaskStart<span class="opt">[</span>nPos<span class="opt">][</span><span class="num">0</span><span class="opt">] = &amp;</span>g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">];</span>
         <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> nPiece<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>nPiece<span class="opt">&lt;</span>nPieceCount<span class="opt">;</span>nPiece<span class="opt">++)</span>
         <span class="opt">{</span>
            <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> j<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>j<span class="opt">&lt;</span><span class="num">5</span><span class="opt">;</span>j<span class="opt">++)</span>
            <span class="opt">{</span>
               x<span class="opt">[</span>j<span class="opt">] =</span> pieces<span class="opt">[</span>nPiece<span class="opt">][</span>j<span class="opt">][</span><span class="num">0</span><span class="opt">];</span>
               y<span class="opt">[</span>j<span class="opt">] =</span> pieces<span class="opt">[</span>nPiece<span class="opt">][</span>j<span class="opt">][</span><span class="num">1</span><span class="opt">];</span>
            <span class="opt">}</span>
         
            <span class="kwb">int</span> nCurrentRotation<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>
            <span class="kwa">for</span> <span class="opt">(</span>nCurrentRotation<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>nCurrentRotation<span class="opt">&lt;</span><span class="num">12</span><span class="opt">;</span>nCurrentRotation<span class="opt">++)</span>
            <span class="opt">{</span>
               <span class="kwa">if</span> <span class="opt">(</span>nPiece<span class="opt">!=</span><span class="num">3</span><span class="opt">||(</span>nCurrentRotation<span class="opt">/</span><span class="num">3</span><span class="opt">)%</span><span class="num">2</span><span class="opt">==</span><span class="num">0</span><span class="opt">)</span>
               <span class="opt">{</span>
                  <span class="kwb">int</span> nMinX <span class="opt">=</span> x<span class="opt">[</span><span class="num">0</span><span class="opt">];</span>
                  <span class="kwb">int</span> nMinY <span class="opt">=</span> y<span class="opt">[</span><span class="num">0</span><span class="opt">];</span>
                  <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> i<span class="opt">=</span><span class="num">1</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">5</span><span class="opt">;</span>i<span class="opt">++)</span>
                  <span class="opt">{</span>
                     <span class="kwa">if</span> <span class="opt">(</span>y<span class="opt">[</span>i<span class="opt">]&lt;</span>nMinY<span class="opt">||(</span>y<span class="opt">[</span>i<span class="opt">]==</span>nMinY<span class="opt">&amp;&amp;</span>x<span class="opt">[</span>i<span class="opt">]&lt;</span>nMinX<span class="opt">))</span>
                     <span class="opt">{</span>
                        nMinX<span class="opt">=</span>x<span class="opt">[</span>i<span class="opt">];</span>
                        nMinY<span class="opt">=</span>y<span class="opt">[</span>i<span class="opt">];</span>
                     <span class="opt">}</span>
                  <span class="opt">}</span>
            
                  <span class="kwb">unsigned int</span> mask <span class="opt">=</span> <span class="num">0</span><span class="opt">;</span>
                  <span class="kwb">bool</span> <span class="kwd">bFit</span><span class="opt">(</span><span class="kwa">true</span><span class="opt">);</span>
            
                  <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">5</span><span class="opt">;</span>i<span class="opt">++)</span>
                  <span class="opt">{</span>
                     <span class="kwb">int</span> nX <span class="opt">= (</span>x<span class="opt">[</span>i<span class="opt">]-</span>nMinX<span class="opt">+(</span>nXBase<span class="opt">-</span>nYBase<span class="opt">/</span><span class="num">2</span><span class="opt">))</span>
                              <span class="opt">+(</span>y<span class="opt">[</span>i<span class="opt">]-</span>nMinY<span class="opt">+</span>nYBase<span class="opt">)/</span><span class="num">2</span><span class="opt">;</span>
                     <span class="kwb">int</span> nY <span class="opt">=</span> y<span class="opt">[</span>i<span class="opt">]-</span>nMinY<span class="opt">+</span>nYBase<span class="opt">;</span>
                     <span class="kwa">if</span> <span class="opt">(</span>nX<span class="opt">&gt;=</span><span class="num">0</span><span class="opt">&amp;&amp;</span>nX<span class="opt">&lt;</span><span class="num">5</span><span class="opt">)</span>
                     <span class="opt">{</span>
                        <span class="kwb">int</span> nBit <span class="opt">=</span> nX<span class="opt">-</span>nXBase<span class="opt">+</span><span class="num">5</span><span class="opt">*(</span>nY<span class="opt">-</span>nYBase<span class="opt">);</span>
                        mask <span class="opt">|= (</span><span class="num">1</span><span class="opt">&lt;&lt;</span>nBit<span class="opt">);</span>
                     <span class="opt">}</span>
                     <span class="kwa">else</span>
                     <span class="opt">{</span>
                        bFit <span class="opt">=</span> <span class="kwa">false</span><span class="opt">;</span>
                     <span class="opt">}</span>
                  <span class="opt">}</span>
                  <span class="kwa">if</span> <span class="opt">(</span>bFit<span class="opt">)</span>
                  <span class="opt">{</span>
                     <span class="kwa">if</span> <span class="opt">(</span><span class="kwd">GoodPiece</span><span class="opt">(</span>mask<span class="opt">,</span>nPos<span class="opt">))</span>
                     <span class="opt">{</span>
                        g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">++] =</span> 
                           mask<span class="opt">|(</span><span class="num">1</span><span class="opt">&lt;&lt;(</span>nPiece<span class="opt">+</span><span class="num">22</span><span class="opt">));</span>
                     <span class="opt">}</span>
                  <span class="opt">}</span>
               <span class="opt">}</span>
               <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">5</span><span class="opt">;</span>i<span class="opt">++)</span>
               <span class="opt">{</span>
                  <span class="kwb">int</span> xnew <span class="opt">=</span> x<span class="opt">[</span>i<span class="opt">]+</span>y<span class="opt">[</span>i<span class="opt">];</span>
                  <span class="kwb">int</span> ynew <span class="opt">= -</span>x<span class="opt">[</span>i<span class="opt">];</span>
                  x<span class="opt">[</span>i<span class="opt">] =</span> xnew<span class="opt">;</span>
                  y<span class="opt">[</span>i<span class="opt">] =</span> ynew<span class="opt">;</span>
                  <span class="kwa">if</span> <span class="opt">(</span>nCurrentRotation<span class="opt">==</span><span class="num">5</span><span class="opt">)</span>
                  <span class="opt">{</span>
                     <span class="kwb">int</span> xnew <span class="opt">=</span> x<span class="opt">[</span>i<span class="opt">]+</span>y<span class="opt">[</span>i<span class="opt">];</span>
                     <span class="kwb">int</span> ynew <span class="opt">= -</span>y<span class="opt">[</span>i<span class="opt">];</span>
                     x<span class="opt">[</span>i<span class="opt">] =</span> xnew<span class="opt">;</span>
                     y<span class="opt">[</span>i<span class="opt">] =</span> ynew<span class="opt">;</span>
                  <span class="opt">}</span>      
               <span class="opt">}</span>
            <span class="opt">}</span>
         <span class="opt">}</span>
         g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">++] =</span> <span class="num">0</span><span class="opt">;</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
   
   <span class="slc">// copy rows 2 and 3 to other rows</span>
   
   <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> nYBase<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>nYBase<span class="opt">&lt;</span><span class="num">10</span><span class="opt">;</span>nYBase<span class="opt">++)</span>
   <span class="opt">{</span>
      <span class="kwa">if</span> <span class="opt">(</span>nYBase<span class="opt">!=</span><span class="num">2</span><span class="opt">&amp;&amp;</span>nYBase<span class="opt">!=</span><span class="num">3</span><span class="opt">)</span>
      <span class="opt">{</span>
         <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> nXBase<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>nXBase<span class="opt">&lt;</span><span class="num">5</span><span class="opt">;</span>nXBase<span class="opt">++)</span>
         <span class="opt">{</span>
            <span class="kwb">int</span> nPos <span class="opt">=</span> nXBase<span class="opt">+</span><span class="num">5</span><span class="opt">*</span>nYBase<span class="opt">;</span>
            <span class="kwb">int</span> nOrigPos <span class="opt">=</span> nXBase<span class="opt">+</span><span class="num">5</span><span class="opt">*(</span>nYBase<span class="opt">%</span><span class="num">2</span><span class="opt">+</span><span class="num">2</span><span class="opt">);</span>
            g_MaskStart<span class="opt">[</span>nPos<span class="opt">][</span><span class="num">0</span><span class="opt">] = &amp;</span>g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">];</span>
            <span class="kwb">unsigned int</span> <span class="opt">*</span>pMask <span class="opt">=</span> g_MaskStart<span class="opt">[</span>nOrigPos<span class="opt">][</span><span class="num">0</span><span class="opt">];</span>
            <span class="kwb">unsigned int</span> bottom <span class="opt">= (</span><span class="num">0xFFFC000000000000</span>ULL<span class="opt">&gt;&gt;</span>nPos<span class="opt">)</span>
                                 <span class="opt">&amp;</span><span class="num">0x003FFFFF</span><span class="opt">;</span>
            <span class="kwb">unsigned int</span> last_row <span class="opt">= (</span><span class="num">0xFFFC000000000000</span>ULL<span class="opt">&gt;&gt;(</span>nPos<span class="opt">+</span><span class="num">5</span><span class="opt">))</span>
                                 <span class="opt">&amp;</span><span class="num">0x003FFFFF</span><span class="opt">;</span>
            <span class="kwa">while</span> <span class="opt">(*</span>pMask<span class="opt">)</span>
            <span class="opt">{</span>
               <span class="kwb">unsigned int</span> mask<span class="opt">=*</span>pMask<span class="opt">;</span>
               pMask<span class="opt">++;</span>
               <span class="kwa">if</span> <span class="opt">((</span>mask<span class="opt">&amp;</span>bottom<span class="opt">)==</span><span class="num">0</span><span class="opt">)</span>
               <span class="opt">{</span>
                  <span class="kwa">if</span> <span class="opt">(</span>nYBase<span class="opt">==</span><span class="num">0</span><span class="opt">||(</span>mask<span class="opt">&amp;</span>last_row<span class="opt">))</span>
                  <span class="opt">{</span>
                     <span class="kwa">if</span> <span class="opt">(!</span><span class="kwd">GoodPiece</span><span class="opt">(</span>mask<span class="opt">&amp;</span><span class="num">0x003FFFFF</span><span class="opt">,</span>nPos<span class="opt">))</span>
                     <span class="opt">{</span>
                        <span class="kwa">continue</span><span class="opt">;</span>
                     <span class="opt">}</span>
                  <span class="opt">}</span>
                  g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">++] =</span> mask<span class="opt">;</span>
               <span class="opt">}</span>
            <span class="opt">}</span>
            g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">++] =</span> <span class="num">0</span><span class="opt">;</span>
         <span class="opt">}</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
   
   <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> nFilter<span class="opt">=</span><span class="num">1</span><span class="opt">;</span>nFilter<span class="opt">&lt;</span><span class="num">8</span><span class="opt">;</span>nFilter<span class="opt">++)</span>
   <span class="opt">{</span>
      <span class="kwa">for</span> <span class="opt">(</span><span class="kwb">int</span> nPos<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>nPos<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>nPos<span class="opt">++)</span>
      <span class="opt">{</span>
         g_MaskStart<span class="opt">[</span>nPos<span class="opt">][</span>nFilter<span class="opt">] = &amp;</span>g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">];</span>
         <span class="kwb">unsigned int</span> filter_mask<span class="opt">;</span>
         filter_mask <span class="opt">= ((</span>nFilter<span class="opt">&amp;</span><span class="num">1</span><span class="opt">)&lt;&lt;</span><span class="num">1</span><span class="opt">)|((</span>nFilter<span class="opt">&amp;</span><span class="num">6</span><span class="opt">)&lt;&lt;</span>
                     <span class="opt">(</span><span class="num">4</span><span class="opt">-(</span>EvenRowsLookup<span class="opt">[</span>nPos<span class="opt">]&amp;</span><span class="num">1</span><span class="opt">)));</span>
         <span class="kwb">unsigned int</span> <span class="opt">*</span>pMask <span class="opt">=</span> g_MaskStart<span class="opt">[</span>nPos<span class="opt">][</span><span class="num">0</span><span class="opt">];</span>
         <span class="kwa">while</span> <span class="opt">(*</span>pMask<span class="opt">)</span>
         <span class="opt">{</span>
            <span class="kwb">unsigned int</span> mask<span class="opt">=*</span>pMask<span class="opt">;</span>
            <span class="kwa">if</span> <span class="opt">((</span>mask<span class="opt">&amp;</span>filter_mask<span class="opt">)==</span><span class="num">0</span><span class="opt">)</span>
            <span class="opt">{</span>
               g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">++] =</span> mask<span class="opt">;</span>
            <span class="opt">}</span>
            pMask<span class="opt">++;</span>
         <span class="opt">}</span>
         g_AllMasks<span class="opt">[</span>nTotalCount<span class="opt">++] =</span> <span class="num">0</span><span class="opt">;</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
<span class="opt">}</span>

<span class="kwb">void</span> <span class="kwd">CompareSolution</span><span class="opt">(</span><span class="kwb">unsigned char</span><span class="opt">*</span> board<span class="opt">,</span> <span class="kwb">unsigned char</span><span class="opt">*</span> min_solution<span class="opt">,</span>
               <span class="kwb">unsigned char</span><span class="opt">*</span> max_solution<span class="opt">)</span>
<span class="opt">{</span>
   <span class="kwb">int</span> i<span class="opt">,</span>j<span class="opt">;</span>
   
   <span class="kwa">for</span> <span class="opt">(</span>i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>i<span class="opt">++)</span>
   <span class="opt">{</span>
      <span class="kwa">if</span> <span class="opt">(</span>board<span class="opt">[</span>i<span class="opt">]&lt;</span>min_solution<span class="opt">[</span>i<span class="opt">])</span>
      <span class="opt">{</span>
         <span class="kwa">for</span> <span class="opt">(</span>j<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>j<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>j<span class="opt">++)</span>
         <span class="opt">{</span>
            min_solution<span class="opt">[</span>j<span class="opt">] =</span> board<span class="opt">[</span>j<span class="opt">];</span>
         <span class="opt">}</span>
         <span class="kwa">break</span><span class="opt">;</span>
      <span class="opt">}</span>
      <span class="kwa">else if</span> <span class="opt">(</span>board<span class="opt">[</span>i<span class="opt">]&gt;</span>min_solution<span class="opt">[</span>i<span class="opt">])</span>
      <span class="opt">{</span>
         <span class="kwa">break</span><span class="opt">;</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
   <span class="kwa">for</span> <span class="opt">(</span>i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>i<span class="opt">++)</span>
   <span class="opt">{</span>
      <span class="kwa">if</span> <span class="opt">(</span>board<span class="opt">[</span>i<span class="opt">]&gt;</span>max_solution<span class="opt">[</span>i<span class="opt">])</span>
      <span class="opt">{</span>
         <span class="kwa">for</span> <span class="opt">(</span>j<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>j<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>j<span class="opt">++)</span>
         <span class="opt">{</span>
            max_solution<span class="opt">[</span>j<span class="opt">] =</span> board<span class="opt">[</span>j<span class="opt">];</span>
         <span class="opt">}</span>
         <span class="kwa">break</span><span class="opt">;</span>
      <span class="opt">}</span>
      <span class="kwa">else if</span> <span class="opt">(</span>board<span class="opt">[</span>i<span class="opt">]&lt;</span>max_solution<span class="opt">[</span>i<span class="opt">])</span>
      <span class="opt">{</span>
         <span class="kwa">break</span><span class="opt">;</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
<span class="opt">}</span>

<span class="kwb">void</span> <span class="kwd">PrintBoard</span><span class="opt">(</span><span class="kwb">unsigned char</span> <span class="opt">*</span>board<span class="opt">)</span>
<span class="opt">{</span>
   <span class="kwb">int</span> i<span class="opt">;</span>
   
   <span class="kwa">for</span> <span class="opt">(</span>i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>i<span class="opt">++)</span>
   <span class="opt">{</span>
      <span class="kwd">printf</span> <span class="opt">(</span><span class="str">&quot;%d &quot;</span><span class="opt">,</span> board<span class="opt">[</span>i<span class="opt">]);</span>
      <span class="kwa">if</span> <span class="opt">(</span>i<span class="opt">%</span><span class="num">5</span><span class="opt">==</span><span class="num">4</span><span class="opt">)</span>
      <span class="opt">{</span>
         <span class="kwd">printf</span><span class="opt">(</span><span class="str">&quot;</span><span class="esc">\n</span><span class="str">&quot;</span><span class="opt">);</span>
         <span class="kwa">if</span> <span class="opt">((</span>i<span class="opt">&amp;</span><span class="num">1</span><span class="opt">)==</span><span class="num">0</span><span class="opt">)</span>
         <span class="opt">{</span>
            <span class="kwd">printf</span> <span class="opt">(</span><span class="str">&quot; &quot;</span><span class="opt">);</span>
         <span class="opt">}</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
   <span class="kwd">printf</span> <span class="opt">(</span><span class="str">&quot;</span><span class="esc">\n</span><span class="str">&quot;</span><span class="opt">);</span>
   
<span class="opt">}</span>

<span class="kwb">void</span> <span class="kwd">RecordSolution</span><span class="opt">(</span><span class="kwb">unsigned int</span> current_solution<span class="opt">[])</span>
<span class="opt">{</span>
   <span class="kwb">unsigned char</span> board<span class="opt">[</span><span class="num">50</span><span class="opt">],</span> flip_board<span class="opt">[</span><span class="num">50</span><span class="opt">];</span>
   <span class="kwb">int</span> i<span class="opt">;</span>
   <span class="kwb">unsigned long</span> piece<span class="opt">;</span>
   <span class="kwb">unsigned int</span> mask<span class="opt">,</span> pos<span class="opt">,</span> current_bit<span class="opt">,</span> b1<span class="opt">;</span>
   <span class="kwb">unsigned long</span> count<span class="opt">;</span>
   b1 <span class="opt">=</span> <span class="num">0</span><span class="opt">;</span>
   pos <span class="opt">=</span> <span class="num">0</span><span class="opt">;</span>
   <span class="kwa">for</span> <span class="opt">(</span>i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">10</span><span class="opt">;</span>i<span class="opt">++)</span>
   <span class="opt">{</span>
      mask <span class="opt">=</span> current_solution<span class="opt">[</span>i<span class="opt">];</span>
      piece <span class="opt">=</span> <span class="kwd">__builtin_ctz</span><span class="opt">(</span>mask<span class="opt">&gt;&gt;</span><span class="num">22</span><span class="opt">);</span>
      mask <span class="opt">&amp;=</span> <span class="num">0x003FFFFF</span><span class="opt">;</span>
      b1 <span class="opt">|=</span> mask<span class="opt">;</span>
      <span class="kwa">while</span> <span class="opt">(</span>mask<span class="opt">)</span>
      <span class="opt">{</span>
         current_bit <span class="opt">=</span> mask<span class="opt">&amp;-</span>mask<span class="opt">;</span>
         count <span class="opt">=</span> <span class="kwd">__builtin_ctz</span><span class="opt">(</span>current_bit<span class="opt">);</span>
         board<span class="opt">[</span>count<span class="opt">+</span>pos<span class="opt">] =</span> piece<span class="opt">;</span>
         flip_board<span class="opt">[</span><span class="num">49</span><span class="opt">-</span>count<span class="opt">-</span>pos<span class="opt">] =</span> piece<span class="opt">;</span>
         mask <span class="opt">^=</span> current_bit<span class="opt">;</span>
      <span class="opt">}</span>
      count <span class="opt">=</span> <span class="kwd">__builtin_ctz</span><span class="opt">(~</span>b1<span class="opt">);</span>
      pos<span class="opt">+=</span>count<span class="opt">;</span>
      b1 <span class="opt">&gt;&gt;=</span> count<span class="opt">;</span>
   <span class="opt">}</span>
   <span class="kwa">if</span> <span class="opt">(</span>g_solutions<span class="opt">==</span><span class="num">0</span><span class="opt">)</span>
   <span class="opt">{</span>
      <span class="kwa">for</span> <span class="opt">(</span>i<span class="opt">=</span><span class="num">0</span><span class="opt">;</span>i<span class="opt">&lt;</span><span class="num">50</span><span class="opt">;</span>i<span class="opt">++)</span>
      <span class="opt">{</span>
         g_min_solution<span class="opt">[</span>i<span class="opt">] =</span> g_max_solution<span class="opt">[</span>i<span class="opt">] =</span> board<span class="opt">[</span>i<span class="opt">];</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
   <span class="kwa">else</span>
   <span class="opt">{</span>
      <span class="kwd">CompareSolution</span><span class="opt">(</span>board<span class="opt">,</span> g_min_solution<span class="opt">,</span> g_max_solution<span class="opt">);</span>
      <span class="kwd">CompareSolution</span><span class="opt">(</span>flip_board<span class="opt">,</span> g_min_solution<span class="opt">,</span> g_max_solution<span class="opt">);</span>
   <span class="opt">}</span>
   
   g_solutions<span class="opt">+=</span><span class="num">2</span><span class="opt">;</span>
<span class="opt">}</span>
     
<span class="kwb">void</span> <span class="kwd">searchLinear</span><span class="opt">(</span><span class="kwb">unsigned int</span> board<span class="opt">,</span> <span class="kwb">unsigned int</span> pos<span class="opt">,</span> <span class="kwb">unsigned int</span> used<span class="opt">,</span> 
         <span class="kwb">unsigned int</span> placed<span class="opt">,</span> <span class="kwb">unsigned int</span> current_solution<span class="opt">[])</span>
<span class="opt">{</span>
   <span class="kwb">unsigned long</span> count<span class="opt">;</span>
   <span class="kwb">unsigned int</span> even_rows<span class="opt">,</span> odd_rows<span class="opt">,</span> left_border<span class="opt">,</span> right_border<span class="opt">,</span> s1<span class="opt">,</span> s2<span class="opt">,</span> s3<span class="opt">,</span>
                  s4<span class="opt">,</span> s5<span class="opt">,</span> s6<span class="opt">,</span> s7<span class="opt">,</span> s8<span class="opt">;</span>
   <span class="kwa">if</span> <span class="opt">(</span>placed<span class="opt">==</span><span class="num">10</span><span class="opt">)</span>
   <span class="opt">{</span>
      <span class="ppc">#pragma omp critical</span>
      <span class="kwd">RecordSolution</span><span class="opt">(</span>current_solution<span class="opt">);</span>
   <span class="opt">}</span>
   <span class="kwa">else</span>
   <span class="opt">{</span>
      even_rows <span class="opt">=</span> EvenRowsLookup<span class="opt">[</span>pos<span class="opt">];</span>

      odd_rows <span class="opt">= ~</span>even_rows<span class="opt">;</span>
      
      left_border <span class="opt">=</span> LeftBorderLookup<span class="opt">[</span>pos<span class="opt">];</span>
      right_border <span class="opt">=</span> left_border<span class="opt">&gt;&gt;</span><span class="num">1</span><span class="opt">;</span>

      s1 <span class="opt">= (</span>board <span class="opt">&lt;&lt;</span> <span class="num">1</span><span class="opt">) |</span> left_border<span class="opt">;</span>
      s2 <span class="opt">= (</span>board <span class="opt">&gt;&gt;</span> <span class="num">1</span><span class="opt">) |</span> right_border<span class="opt">;</span>
      s3 <span class="opt">= (</span>board <span class="opt">&lt;&lt;</span> <span class="num">4</span><span class="opt">) | ((</span><span class="num">1</span><span class="opt">&lt;&lt;</span><span class="num">4</span><span class="opt">)-</span><span class="num">1</span><span class="opt">) |</span> right_border<span class="opt">;</span>
      s4 <span class="opt">= (</span>board <span class="opt">&gt;&gt;</span> <span class="num">4</span><span class="opt">) |</span> left_border<span class="opt">;</span>
      s5 <span class="opt">= (</span>board <span class="opt">&lt;&lt;</span> <span class="num">5</span><span class="opt">) | ((</span><span class="num">1</span><span class="opt">&lt;&lt;</span><span class="num">5</span><span class="opt">)-</span><span class="num">1</span><span class="opt">);</span>
      s6 <span class="opt">= (</span>board <span class="opt">&gt;&gt;</span> <span class="num">5</span><span class="opt">);</span>
      s7 <span class="opt">= (</span>board <span class="opt">&lt;&lt;</span> <span class="num">6</span><span class="opt">) | ((</span><span class="num">1</span><span class="opt">&lt;&lt;</span><span class="num">6</span><span class="opt">)-</span><span class="num">1</span><span class="opt">) |</span> left_border<span class="opt">;</span>
      s8 <span class="opt">= (</span>board <span class="opt">&gt;&gt;</span> <span class="num">6</span><span class="opt">) |</span> right_border<span class="opt">;</span>

      <span class="kwa">if</span> <span class="opt">(~</span>board<span class="opt">&amp;</span>s1<span class="opt">&amp;</span>s2<span class="opt">&amp;</span>s5<span class="opt">&amp;</span>s6<span class="opt">&amp;((</span>even_rows<span class="opt">&amp;</span>s4<span class="opt">&amp;</span>s7<span class="opt">)|(</span>odd_rows<span class="opt">&amp;</span>s3<span class="opt">&amp;</span>s8<span class="opt">)))</span>
      <span class="opt">{</span>
         <span class="kwa">return</span><span class="opt">;</span>
      <span class="opt">}</span>
      
      count <span class="opt">=</span> <span class="kwd">__builtin_ctz</span><span class="opt">(~</span>board<span class="opt">);</span>
      pos<span class="opt">+=</span>count<span class="opt">;</span>
      board <span class="opt">&gt;&gt;=</span> count<span class="opt">;</span>
      
      <span class="kwb">unsigned int</span> f<span class="opt">;</span>
      f <span class="opt">= ((</span>board<span class="opt">&gt;&gt;</span><span class="num">1</span><span class="opt">)&amp;</span><span class="num">1</span><span class="opt">)|((</span>board<span class="opt">&gt;&gt;(</span><span class="num">4</span><span class="opt">-(</span>EvenRowsLookup<span class="opt">[</span>pos<span class="opt">]&amp;</span><span class="num">1</span><span class="opt">)))&amp;</span><span class="num">6</span><span class="opt">);</span>   
      <span class="kwb">unsigned int</span> board_and_used <span class="opt">=</span> board<span class="opt">|</span>used<span class="opt">;</span>
      
      <span class="kwb">unsigned int</span> <span class="opt">*</span>masks <span class="opt">=</span> g_MaskStart<span class="opt">[</span>pos<span class="opt">][</span>f<span class="opt">];</span>
      <span class="kwb">unsigned int</span> mask<span class="opt">;</span>
      
      <span class="kwa">while</span> <span class="opt">(*</span>masks<span class="opt">)</span>
      <span class="opt">{</span>
         <span class="kwa">while</span> <span class="opt">((*</span>masks<span class="opt">)&amp;</span>board_and_used<span class="opt">)</span>
         <span class="opt">{</span>
            masks<span class="opt">++;</span>
         <span class="opt">}</span>
         <span class="kwa">if</span> <span class="opt">(*</span>masks<span class="opt">)</span>
         <span class="opt">{</span>
            mask <span class="opt">= *</span>masks<span class="opt">;</span>
            current_solution<span class="opt">[</span>placed<span class="opt">] =</span> mask<span class="opt">;</span>
            <span class="kwd">searchLinear</span><span class="opt">(</span>board<span class="opt">|((</span>mask<span class="opt">&amp;</span><span class="num">0x003FFFFF</span><span class="opt">)),</span> pos<span class="opt">,</span> used<span class="opt">|(</span>mask<span class="opt">&amp;</span><span class="num">0xFFC00000</span><span class="opt">),</span>
                  placed<span class="opt">+</span><span class="num">1</span><span class="opt">,</span> current_solution<span class="opt">);</span>
            masks<span class="opt">++;</span>
         <span class="opt">}</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
<span class="opt">}</span>

<span class="kwb">void</span> <span class="kwd">searchParallel</span><span class="opt">(</span><span class="kwb">unsigned int</span> board<span class="opt">,</span> <span class="kwb">unsigned int</span> pos<span class="opt">,</span> <span class="kwb">unsigned int</span> used<span class="opt">,</span> 
         <span class="kwb">unsigned int</span> placed<span class="opt">,</span> <span class="kwb">unsigned int</span> first_piece<span class="opt">)</span>
<span class="opt">{</span>
   <span class="kwb">unsigned long</span> count<span class="opt">;</span>
                     
   count <span class="opt">=</span> <span class="kwd">__builtin_ctz</span><span class="opt">(~</span>board<span class="opt">);</span>
   pos<span class="opt">+=</span>count<span class="opt">;</span>
   board <span class="opt">&gt;&gt;=</span> count<span class="opt">;</span>
   
   <span class="kwb">unsigned int</span> board_and_used <span class="opt">=</span> board<span class="opt">|</span>used<span class="opt">;</span>
   
   <span class="kwb">unsigned int</span> <span class="opt">*</span>masks <span class="opt">=</span> g_MaskStart<span class="opt">[</span>pos<span class="opt">][</span><span class="num">0</span><span class="opt">];</span>
   <span class="kwb">unsigned int</span> mask<span class="opt">;</span>
   
   <span class="kwa">if</span> <span class="opt">(</span>placed<span class="opt">==</span><span class="num">0</span><span class="opt">)</span>
   <span class="opt">{</span>
      <span class="kwa">while</span> <span class="opt">(*</span>masks<span class="opt">)</span>
      <span class="opt">{</span>
         <span class="kwa">while</span> <span class="opt">((*</span>masks<span class="opt">)&amp;</span>board_and_used<span class="opt">)</span>
         <span class="opt">{</span>
            masks<span class="opt">++;</span>
         <span class="opt">}</span>
         <span class="kwa">if</span> <span class="opt">(*</span>masks<span class="opt">)</span>
         <span class="opt">{</span>
            mask <span class="opt">= *</span>masks<span class="opt">++;</span>
            <span class="opt">{</span>
               <span class="kwd">searchParallel</span><span class="opt">(</span>board<span class="opt">|((</span>mask<span class="opt">&amp;</span><span class="num">0x003FFFFF</span><span class="opt">)),</span> pos<span class="opt">,</span> used<span class="opt">|(</span>mask<span class="opt">&amp;</span><span class="num">0xFFC00000</span><span class="opt">),</span>
                  placed<span class="opt">+</span><span class="num">1</span><span class="opt">,</span> mask<span class="opt">);</span>
            <span class="opt">}</span>
         <span class="opt">}</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
   <span class="kwa">else</span>
   <span class="opt">{</span>   <span class="slc">// placed==1</span>
      <span class="kwa">while</span> <span class="opt">(*</span>masks<span class="opt">)</span>
      <span class="opt">{</span>
         <span class="kwa">while</span> <span class="opt">((*</span>masks<span class="opt">)&amp;</span>board_and_used<span class="opt">)</span>
         <span class="opt">{</span>
            masks<span class="opt">++;</span>
         <span class="opt">}</span>
         <span class="kwa">if</span> <span class="opt">(*</span>masks<span class="opt">)</span>
         <span class="opt">{</span>
            mask <span class="opt">= *</span>masks<span class="opt">++;</span>
            <span class="ppc">#pragma omp task default(none) firstprivate(board, mask, pos, used, placed, first_piece)</span>
            <span class="opt">{</span>
               <span class="kwb">unsigned int</span> current_solution<span class="opt">[</span><span class="num">10</span><span class="opt">];</span>
               current_solution<span class="opt">[</span><span class="num">0</span><span class="opt">] =</span> first_piece<span class="opt">;</span>
               current_solution<span class="opt">[</span>placed<span class="opt">] =</span> mask<span class="opt">;</span>
               <span class="kwd">searchLinear</span><span class="opt">(</span>board<span class="opt">|((</span>mask<span class="opt">&amp;</span><span class="num">0x003FFFFF</span><span class="opt">)),</span> pos<span class="opt">,</span> used<span class="opt">|(</span>mask<span class="opt">&amp;</span><span class="num">0xFFC00000</span><span class="opt">),</span>
                  placed<span class="opt">+</span><span class="num">1</span><span class="opt">,</span> current_solution<span class="opt">);</span>
            <span class="opt">}</span>
         <span class="opt">}</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
<span class="opt">}</span>


<span class="kwb">int</span> <span class="kwd">main</span><span class="opt">(</span><span class="kwb">int</span> argc<span class="opt">,</span> <span class="kwb">char</span><span class="opt">*</span> argv<span class="opt">[])</span>
<span class="opt">{</span>
   <span class="kwa">if</span> <span class="opt">(</span>argc <span class="opt">&gt;</span> <span class="num">2</span><span class="opt">)</span>
     <span class="kwa">return</span> <span class="num">1</span><span class="opt">;</span>

   <span class="kwd">Initialise</span><span class="opt">();</span>

   g_solutions <span class="opt">=</span> <span class="num">0</span><span class="opt">;</span>

   <span class="ppc">#pragma omp parallel</span>
   <span class="opt">{</span>
      <span class="ppc">#pragma omp single</span>
      <span class="opt">{</span>
         <span class="kwd">searchParallel</span><span class="opt">(</span><span class="num">0</span><span class="opt">,</span><span class="num">0</span><span class="opt">,</span><span class="num">0</span><span class="opt">,</span><span class="num">0</span><span class="opt">,</span><span class="num">0</span><span class="opt">);</span>
      <span class="opt">}</span>
   <span class="opt">}</span>
   
   <span class="kwd">printf</span> <span class="opt">(</span><span class="str">&quot;%d solutions found</span><span class="esc">\n\n</span><span class="str">&quot;</span><span class="opt">,</span>g_solutions<span class="opt">);</span>
   <span class="kwd">PrintBoard</span><span class="opt">(</span>g_min_solution<span class="opt">);</span>
   <span class="kwd">PrintBoard</span><span class="opt">(</span>g_max_solution<span class="opt">);</span>
                        
   <span class="kwa">return</span> <span class="num">0</span><span class="opt">;</span>
<span class="opt">}</span>
    </pre>
  </section>
  <section>
    <h3 id="log">notes, command-line, and program output</h3>
    <pre>
NOTES:
64-bit Ubuntu quad core
g++ (Ubuntu 7.2.0-8ubuntu3) 7.2.0


Mon, 30 Oct 2017 21:58:40 GMT

MAKE:
/usr/bin/g++ -c -pipe -O3 -fomit-frame-pointer -march=native  -fopenmp meteor.gpp-6.c++ -o meteor.gpp-6.c++.o &amp;&amp;  \
        /usr/bin/g++ meteor.gpp-6.c++.o -o meteor.gpp-6.gpp_run -fopenmp 
rm meteor.gpp-6.c++

0.47s to complete and log all make actions

COMMAND LINE:
./meteor.gpp-6.gpp_run 2098

PROGRAM OUTPUT:
2098 solutions found

0 0 0 0 1 
 2 2 2 0 1 
2 6 6 1 1 
 2 6 1 5 5 
8 6 5 5 5 
 8 6 3 3 3 
4 8 8 9 3 
 4 4 8 9 3 
4 7 4 7 9 
 7 7 7 9 9 

9 9 9 9 8 
 9 6 6 8 5 
6 6 8 8 5 
 6 8 2 5 5 
7 7 7 2 5 
 7 4 7 2 0 
1 4 2 2 0 
 1 4 4 0 3 
1 4 0 0 3 
 1 1 3 3 3 

    </pre>
  </section>
</article>
<footer>
  <nav>
    <ul>
      <li><a href="./license.html"><span>license</span></a>
    </ul>
  </nav>
</footer>

