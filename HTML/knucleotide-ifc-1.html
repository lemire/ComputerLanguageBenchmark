<!DOCTYPE html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="robots" content="noindex,follow,noarchive">

<title>k-nucleotide Fortran Intel program | Computer Language Benchmarks Game </title>
<style><!--
a{color:black;text-decoration:none}article{padding: 0 0 2.9em}article,div,footer,header{margin:auto;width:92%}body{font:100% Droid Sans,Ubuntu,Verdana,sans-serif;margin:0;-webkit-text-size-adjust:100%}h1,h2,h3,li a{font-family:Ubuntu Mono,Consolas,Menlo,monospace}div,footer,header{max-width:31em}footer{padding:2.6em 0 0}h1{font-size:1.4em;font-weight:bold;margin:0;padding:.4em}h1,h1 a{color:white}h2,h3{margin:1.5em 0 0}h2{font-size:1.4em;font-weight:normal}h3{font-size:1.2em}li{list-style-type:none;vertical-align:top}li a{display:block;font-size:1.2em;margin:.5em .5em 0;padding:.5em .5em .3em}ul{clear:left;margin:-0.3em 0 1.5em;padding-left:0;text-align:center}p{color:#333;line-height:1.4;margin:.3em 0 0}p a,a span{border-bottom:.1em solid #333;padding-bottom:.1em}#u64,#u64q{background-color:#c90016}#u32{background-color:#ffb515}#u32q{background-color:#ff6309}.com,.slc{color:#888}.kwa{color:#066}.kwb{color:#900}.kwc{color:#050}.kwa,.kwb,.kwc{font-weight:bold}.dstr,.str,.sym,.num{color:#930}pre{color:#222;font-size:1em;overflow-wrap:break-word;white-space:pre-wrap;word-wrap:break-word}@media only screen and (min-width:60em){article,footer,header{font-size:1.25em}}
--></style>
<link rel="shortcut icon" href="./favicon.ico">
<header id="top">
  <h1 id="u64q"><a href="./index.html">The&nbsp;Computer&nbsp;Language<br>Benchmarks&nbsp;Game</a></h1>
</header>
<article>
  <div>
    <h2>k-nucleotide Fortran Intel program</h2>
    <aside>
      <p><a href="./knucleotide-description.html#knucleotide">description</a>
    </aside>
  </div>
  <section>
    </div>
      <h3>source code</h3>
    </div>
    <pre>
<span class="slc">! The Computer Language Benchmarks Game</span>
<span class="slc">! http://benchmarksgame.alioth.debian.org/</span>
<span class="slc">!</span>
<span class="slc">! contributed by Steve Decker</span>
<span class="slc">! using the hash function posted by Rich Townsend to comp.lang.fortran</span>
<span class="slc">! on 5 October 2005.</span>
<span class="slc">! compilation:</span>
<span class="slc">!    g95 -O1 knucleotide.f90</span>
<span class="slc">!    ifort -O3 -ip knucleotide.f90</span>
<span class="slc">!</span>
<span class="slc">! This implementation requires TR15581</span>

<span class="kwa">module</span> knuc_mod
  <span class="kwa">implicit none</span>
  private
  public <span class="opt">::</span> init_table<span class="opt">,</span> read_frame<span class="opt">,</span> keys_of_given_len<span class="opt">,</span> cnt

  <span class="kwa">integer</span><span class="opt">,</span> <span class="kwa">parameter</span> <span class="opt">::</span> MaxWordLen <span class="opt">=</span> <span class="num">18</span>

  <span class="kwa">type</span><span class="opt">,</span> public <span class="opt">::</span> <span class="kwa">key</span>
     <span class="kwa">integer</span>                   <span class="opt">::</span> count <span class="opt">=</span> <span class="num">0</span>
     <span class="kwa">character</span><span class="opt">(</span>len<span class="opt">=</span>MaxWordLen<span class="opt">) ::</span> word <span class="opt">=</span> <span class="str">&quot;&quot;</span>
  <span class="kwa">end type key</span>

  <span class="kwa">type</span><span class="opt">,</span> public <span class="opt">::</span> table
     private
     <span class="kwa">integer</span> <span class="opt">::</span> hashBits<span class="opt">,</span> maxWords<span class="opt">,</span> nWords
     <span class="kwa">type</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">),</span> allocatable<span class="opt">,</span> <span class="kwa">dimension</span><span class="opt">(:) ::</span> words
  <span class="kwa">end type</span> table

<span class="kwa">contains</span>

  pure <span class="kwa">subroutine</span> <span class="kwd">init_table</span><span class="opt">(</span>kNuc<span class="opt">,</span> nBits<span class="opt">)</span>
    <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">),</span> <span class="kwd">intent</span><span class="opt">(</span>out<span class="opt">) ::</span> kNuc
    <span class="kwa">integer</span><span class="opt">,</span>     <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">)  ::</span> nBits

    kNuc <span class="opt">=</span> <span class="kwd">table</span><span class="opt">(</span>nBits<span class="opt">,</span> <span class="num">2</span><span class="opt">**</span>nBits<span class="opt">,</span> <span class="num">0</span><span class="opt">,</span> <span class="kwd">null</span><span class="opt">())</span>
    <span class="kwd">allocate</span><span class="opt">(</span>kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>kNuc<span class="opt">%</span>maxWords<span class="opt">))</span>
  <span class="kwa">end subroutine</span> init_table

  <span class="kwa">subroutine</span> <span class="kwd">read_frame</span><span class="opt">(</span>buf<span class="opt">,</span> n<span class="opt">,</span> length<span class="opt">,</span> kNuc<span class="opt">)</span>
    <span class="kwa">character</span><span class="opt">,</span> <span class="kwa">dimension</span><span class="opt">(:),</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">)    ::</span> buf
    <span class="kwa">integer</span><span class="opt">,</span>                 <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">)    ::</span> n<span class="opt">,</span> length
    <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">),</span>             <span class="kwd">intent</span><span class="opt">(</span>inout<span class="opt">) ::</span> kNuc

    <span class="kwa">integer</span>               <span class="opt">::</span> i<span class="opt">,</span> j
    <span class="kwa">character</span><span class="opt">(</span>len<span class="opt">=</span>length<span class="opt">) ::</span> word

    <span class="kwa">do</span> i <span class="opt">=</span> <span class="num">1</span><span class="opt">,</span> n
       <span class="kwa">do</span> j <span class="opt">=</span> <span class="num">1</span><span class="opt">,</span> length
          <span class="kwd">word</span><span class="opt">(</span>j<span class="opt">:</span>j<span class="opt">) =</span> <span class="kwd">buf</span><span class="opt">(</span>i<span class="opt">+</span>j<span class="opt">-</span><span class="num">1</span><span class="opt">)</span>
       <span class="kwa">end do</span>
       <span class="kwa">call</span> <span class="kwd">add</span><span class="opt">(</span>kNuc<span class="opt">,</span> word<span class="opt">)</span>
    <span class="kwa">end do</span>
  <span class="kwa">end subroutine</span> read_frame

  <span class="kwa">subroutine</span> <span class="kwd">add</span><span class="opt">(</span>kNuc<span class="opt">,</span> word<span class="opt">)</span>
    <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">),</span>      <span class="kwd">intent</span><span class="opt">(</span>inout<span class="opt">) ::</span> kNuc
    <span class="kwa">character</span><span class="opt">(</span>len<span class="opt">=*),</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">)    ::</span> word

    <span class="kwa">integer</span> <span class="opt">::</span> m

    m <span class="opt">=</span> <span class="kwd">hash_value</span><span class="opt">(</span>word<span class="opt">,</span> kNuc<span class="opt">%</span>maxWords<span class="opt">)</span>
    <span class="kwa">do</span>
       <span class="kwa">if</span> <span class="opt">(</span>kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>count <span class="opt">==</span> <span class="num">0</span><span class="opt">)</span> <span class="kwa">then</span>
          kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">) =</span> <span class="kwa">key</span><span class="opt">(</span><span class="num">1</span><span class="opt">,</span> word<span class="opt">)</span>
          kNuc<span class="opt">%</span>nWords <span class="opt">=</span> kNuc<span class="opt">%</span>nWords <span class="opt">+</span> <span class="num">1</span>
          <span class="kwa">if</span> <span class="opt">(</span>kNuc<span class="opt">%</span>nWords <span class="opt">&gt;</span> kNuc<span class="opt">%</span>maxWords<span class="opt">/</span><span class="num">2</span><span class="opt">)</span> <span class="kwa">call</span> <span class="kwd">resize_table</span><span class="opt">(</span>kNuc<span class="opt">)</span>
          exit
       <span class="kwa">else if</span> <span class="opt">(</span>kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>word <span class="opt">==</span> word<span class="opt">)</span> <span class="kwa">then</span>
          kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>count <span class="opt">=</span> kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>count <span class="opt">+</span> <span class="num">1</span>
          exit
       <span class="kwa">end if</span>
       m <span class="opt">=</span> <span class="kwd">merge</span><span class="opt">(</span><span class="num">1</span><span class="opt">,</span> m<span class="opt">+</span><span class="num">1</span><span class="opt">,</span> m <span class="opt">==</span> kNuc<span class="opt">%</span>maxWords<span class="opt">)</span>
    <span class="kwa">end do</span>
  <span class="kwa">end subroutine</span> add

  <span class="kwa">subroutine</span> <span class="kwd">resize_table</span><span class="opt">(</span>kNuc<span class="opt">)</span>
    <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">),</span> <span class="kwd">intent</span><span class="opt">(</span>inout<span class="opt">) ::</span> kNuc

    <span class="kwa">integer</span>     <span class="opt">::</span> i<span class="opt">,</span> m
    <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">) ::</span> temp

    temp <span class="opt">=</span> <span class="kwd">table</span><span class="opt">(</span>kNuc<span class="opt">%</span>hashBits <span class="opt">+</span> <span class="num">1</span><span class="opt">,</span> <span class="num">2</span> <span class="opt">*</span> kNuc<span class="opt">%</span>maxWords<span class="opt">,</span> kNuc<span class="opt">%</span>nWords<span class="opt">,</span> <span class="kwd">null</span><span class="opt">())</span>
    <span class="kwd">allocate</span><span class="opt">(</span>temp<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>temp<span class="opt">%</span>maxWords<span class="opt">))</span>

    <span class="kwa">do</span> i <span class="opt">=</span> <span class="num">1</span><span class="opt">,</span> kNuc<span class="opt">%</span>maxWords
       <span class="kwa">if</span> <span class="opt">(</span>kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>i<span class="opt">)%</span>count <span class="opt">&gt;</span> <span class="num">0</span><span class="opt">)</span> <span class="kwa">then</span>
          m <span class="opt">=</span> <span class="kwd">hash_value</span><span class="opt">(</span><span class="kwd">trim</span><span class="opt">(</span>kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>i<span class="opt">)%</span>word<span class="opt">),</span> temp<span class="opt">%</span>maxWords<span class="opt">)</span>
          <span class="kwa">do</span>
             <span class="kwa">if</span> <span class="opt">(</span>temp<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>count <span class="opt">==</span> <span class="num">0</span><span class="opt">)</span> <span class="kwa">then</span>
                temp<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">) =</span> kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>i<span class="opt">)</span>
                exit
             <span class="kwa">end if</span>
             m <span class="opt">=</span> <span class="kwd">merge</span><span class="opt">(</span><span class="num">1</span><span class="opt">,</span> m<span class="opt">+</span><span class="num">1</span><span class="opt">,</span> m <span class="opt">==</span> temp<span class="opt">%</span>maxWords<span class="opt">)</span>
          <span class="kwa">end do</span>
       <span class="kwa">end if</span>
    <span class="kwa">end do</span>

    kNuc <span class="opt">=</span> temp
  <span class="kwa">end subroutine</span> resize_table

  pure <span class="kwa">function</span> <span class="kwd">keys_of_given_len</span><span class="opt">(</span>kNuc<span class="opt">,</span> length<span class="opt">)</span>
    <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">),</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">) ::</span> kNuc
    <span class="kwa">integer</span><span class="opt">,</span>     <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">) ::</span> length
    <span class="kwa">type</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">),</span> <span class="kwa">dimension</span><span class="opt">(</span><span class="num">4</span><span class="opt">**</span>length<span class="opt">) ::</span> keys_of_given_len

    <span class="kwa">integer</span> <span class="opt">::</span> i<span class="opt">,</span> n

    n <span class="opt">=</span> <span class="num">1</span>
    <span class="kwa">do</span> i <span class="opt">=</span> <span class="num">1</span><span class="opt">,</span> kNuc<span class="opt">%</span>maxWords
       <span class="kwa">if</span> <span class="opt">(</span><span class="kwd">len_trim</span><span class="opt">(</span>kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>i<span class="opt">)%</span>word<span class="opt">) ==</span> length<span class="opt">)</span> <span class="kwa">then</span>
          <span class="kwd">keys_of_given_len</span><span class="opt">(</span>n<span class="opt">) =</span> kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>i<span class="opt">)</span>
          n <span class="opt">=</span> n <span class="opt">+</span> <span class="num">1</span>
          <span class="kwa">if</span> <span class="opt">(</span>n <span class="opt">&gt;</span> <span class="kwd">size</span><span class="opt">(</span>keys_of_given_len<span class="opt">))</span> exit
       <span class="kwa">end if</span>
    <span class="kwa">end do</span>
  <span class="kwa">end function</span> keys_of_given_len

  <span class="kwa">integer function</span> <span class="kwd">cnt</span><span class="opt">(</span>kNuc<span class="opt">,</span> string<span class="opt">)</span>
    <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">),</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">)      ::</span> kNuc
    <span class="kwa">character</span><span class="opt">(</span>len<span class="opt">=*),</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">) ::</span> string

    <span class="kwa">integer</span> <span class="opt">::</span> m

    m <span class="opt">=</span> <span class="kwd">hash_value</span><span class="opt">(</span>string<span class="opt">,</span> kNuc<span class="opt">%</span>maxWords<span class="opt">)</span>
    <span class="kwa">do</span>
       <span class="kwa">if</span> <span class="opt">(</span>kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>word <span class="opt">==</span> string <span class="opt">.</span>or<span class="opt">.</span> kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>count <span class="opt">==</span> <span class="num">0</span><span class="opt">)</span> <span class="kwa">then</span>
          cnt <span class="opt">=</span> kNuc<span class="opt">%</span><span class="kwd">words</span><span class="opt">(</span>m<span class="opt">)%</span>count
          exit
       <span class="kwa">end if</span>
       m <span class="opt">=</span> <span class="kwd">merge</span><span class="opt">(</span><span class="num">1</span><span class="opt">,</span> m<span class="opt">+</span><span class="num">1</span><span class="opt">,</span> m <span class="opt">==</span> kNuc<span class="opt">%</span>maxWords<span class="opt">)</span>
    <span class="kwa">end do</span>
  <span class="kwa">end function</span> cnt

  <span class="kwa">integer function</span> <span class="kwd">hash_value</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">,</span> range<span class="opt">)</span>
    <span class="kwa">character</span><span class="opt">(</span>len<span class="opt">=*),</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">) ::</span> <span class="kwa">key</span>
    <span class="kwa">integer</span><span class="opt">,</span>          <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">) ::</span> range

    <span class="kwa">integer</span> <span class="opt">::</span> len_key<span class="opt">,</span> a<span class="opt">,</span> b<span class="opt">,</span> c<span class="opt">,</span> k

    <span class="slc">! Hash the key into a code, using the algorithm</span>
    <span class="slc">! described by Bob Jenkins at:</span>
    <span class="slc">!  http://burtleburtle.net/bob/hash/doobs.html</span>
    <span class="slc">!</span>
    <span class="slc">! Note that range should be a power of 2, and</span>
    <span class="slc">! that the 32-bit algorithm is used</span>

    len_key <span class="opt">=</span> <span class="kwd">len</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">)</span>

    a <span class="opt">= -</span><span class="num">1640531527</span> <span class="slc">! 0x9E3779B9</span>
    b <span class="opt">=</span> a
    c <span class="opt">=</span> <span class="num">305419896</span>   <span class="slc">! 0x12345678</span>

    k <span class="opt">=</span> <span class="num">1</span>

    <span class="kwa">do</span>
       <span class="kwa">if</span> <span class="opt">(</span>len_key <span class="opt">&lt;</span> <span class="num">12</span><span class="opt">)</span> exit

       <span class="slc">! Pack the key into 32 bits</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">)) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span> <span class="num">8</span><span class="opt">) +  &amp;</span>
            <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span> <span class="num">16</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span> <span class="num">24</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">)) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">)),</span> <span class="num">8</span><span class="opt">) +  &amp;</span>
            <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">)),</span> <span class="num">16</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">)),</span> <span class="num">24</span><span class="opt">)</span>
       c <span class="opt">=</span> c <span class="opt">+</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">)) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">9</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">9</span><span class="opt">)),</span> <span class="num">8</span><span class="opt">) +  &amp;</span>
            <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">10</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">10</span><span class="opt">)),</span> <span class="num">16</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">11</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">11</span><span class="opt">)),</span> <span class="num">24</span><span class="opt">)</span>

       <span class="slc">! Mix it up</span>
       <span class="kwa">call</span> <span class="kwd">hash_mix</span><span class="opt">()</span>
       k <span class="opt">=</span> k <span class="opt">+</span> <span class="num">12</span>
       len_key <span class="opt">=</span> len_key <span class="opt">-</span> <span class="num">12</span>
    <span class="kwa">end do</span>

    c <span class="opt">=</span> c <span class="opt">+</span> len_key

    <span class="slc">! Process remaining bits</span>
    select <span class="kwd">case</span><span class="opt">(</span>len_key<span class="opt">)</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">11</span><span class="opt">)</span>
       c <span class="opt">=</span> c <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">10</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">10</span><span class="opt">)),</span><span class="num">24</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">9</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">9</span><span class="opt">)),</span><span class="num">16</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">)),</span><span class="num">8</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">))</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">10</span><span class="opt">)</span>
       c <span class="opt">=</span> c <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">9</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">9</span><span class="opt">)),</span><span class="num">16</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">)),</span><span class="num">8</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">))</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">9</span><span class="opt">)</span>
       c <span class="opt">=</span> c <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">8</span><span class="opt">)),</span><span class="num">8</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">))</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">8</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">7</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">))</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">7</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">6</span><span class="opt">)),</span><span class="num">16</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">)),</span><span class="num">8</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">))</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">6</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">5</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">))</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">5</span><span class="opt">)</span>
       b <span class="opt">=</span> b <span class="opt">+</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">4</span><span class="opt">))</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">4</span><span class="opt">)</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">3</span><span class="opt">)),</span><span class="num">24</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">3</span><span class="opt">)</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">2</span><span class="opt">)),</span><span class="num">16</span><span class="opt">) +</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">)  &amp;</span>
            <span class="opt">+</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">2</span><span class="opt">)</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ishft</span><span class="opt">(</span><span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">:</span>k<span class="opt">+</span><span class="num">1</span><span class="opt">)),</span><span class="num">8</span><span class="opt">) +</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwd">case</span><span class="opt">(</span><span class="num">1</span><span class="opt">)</span>
       a <span class="opt">=</span> a <span class="opt">+</span> <span class="kwd">ichar</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">(</span>k<span class="opt">:</span>k<span class="opt">))</span>
    <span class="kwa">end</span> select

    <span class="kwa">call</span> <span class="kwd">hash_mix</span><span class="opt">()</span>

    hash_value <span class="opt">=</span> <span class="kwd">iand</span><span class="opt">(</span>c<span class="opt">,</span> range <span class="opt">-</span> <span class="num">1</span><span class="opt">) +</span> <span class="num">1</span>

  <span class="kwa">contains</span>

    <span class="kwa">subroutine</span> hash_mix
      <span class="slc">! Mix a, b and c</span>
      a <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>a <span class="opt">-</span> b <span class="opt">-</span> c<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>c<span class="opt">, -</span><span class="num">13</span><span class="opt">))</span>
      b <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>b <span class="opt">-</span> c <span class="opt">-</span> a<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>a<span class="opt">,</span> <span class="num">8</span><span class="opt">))</span>
      c <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>c <span class="opt">-</span> a <span class="opt">-</span> b<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>b<span class="opt">, -</span><span class="num">13</span><span class="opt">))</span>

      a <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>a <span class="opt">-</span> b <span class="opt">-</span> c<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>c<span class="opt">, -</span><span class="num">12</span><span class="opt">))</span>
      b <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>b <span class="opt">-</span> c <span class="opt">-</span> a<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>a<span class="opt">,</span> <span class="num">16</span><span class="opt">))</span>
      c <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>c <span class="opt">-</span> a <span class="opt">-</span> b<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>b<span class="opt">, -</span><span class="num">5</span><span class="opt">))</span>

      a <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>a <span class="opt">-</span> b <span class="opt">-</span> c<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>c<span class="opt">, -</span><span class="num">3</span><span class="opt">))</span>
      b <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>b <span class="opt">-</span> c <span class="opt">-</span> a<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>a<span class="opt">,</span> <span class="num">10</span><span class="opt">))</span>
      c <span class="opt">=</span> <span class="kwd">ieor</span><span class="opt">(</span>c <span class="opt">-</span> a <span class="opt">-</span> b<span class="opt">,</span> <span class="kwd">ishft</span><span class="opt">(</span>b<span class="opt">, -</span><span class="num">15</span><span class="opt">))</span>
    <span class="kwa">end subroutine</span> hash_mix
  <span class="kwa">end function</span> hash_value
<span class="kwa">end module</span> knuc_mod

<span class="kwa">program</span> knucleotide
  <span class="kwa">use</span> knuc_mod
  <span class="kwa">implicit none</span>

  <span class="kwa">integer</span><span class="opt">,</span> <span class="kwa">parameter</span> <span class="opt">::</span> LineLen <span class="opt">=</span> <span class="num">60</span><span class="opt">,</span> InitialTableSize <span class="opt">=</span> <span class="num">1</span>

  <span class="kwa">integer</span> <span class="opt">::</span> bufferSize <span class="opt">=</span> <span class="num">16384</span><span class="opt">,</span> stat<span class="opt">,</span> n <span class="opt">=</span> <span class="num">0</span><span class="opt">,</span> i
  <span class="kwa">logical</span> <span class="opt">::</span> atThirdPart <span class="opt">= .</span>false<span class="opt">.</span>
  <span class="kwa">type</span><span class="opt">(</span>table<span class="opt">) ::</span> kn
  <span class="kwa">character</span><span class="opt">(</span>len<span class="opt">=</span>LineLen<span class="opt">) ::</span> line
  <span class="kwa">character</span><span class="opt">,</span> <span class="kwa">dimension</span><span class="opt">(:),</span> allocatable <span class="opt">::</span> buffer<span class="opt">,</span> tempBuffer

  <span class="kwa">character</span><span class="opt">,</span> <span class="kwa">dimension</span><span class="opt">(</span><span class="num">65</span><span class="opt">:</span><span class="num">116</span><span class="opt">),</span> <span class="kwa">parameter</span> <span class="opt">::</span> Codes <span class="opt">= (/</span> <span class="str">&quot;A&quot;</span><span class="opt">,</span> <span class="str">&quot; &quot;</span><span class="opt">,</span> <span class="str">&quot;C&quot;</span><span class="opt">,  &amp;</span>
       <span class="opt">(</span><span class="str">&quot; &quot;</span><span class="opt">,</span> i <span class="opt">=</span> <span class="num">68</span><span class="opt">,</span> <span class="num">70</span><span class="opt">),</span> <span class="str">&quot;G&quot;</span><span class="opt">, (</span><span class="str">&quot; &quot;</span><span class="opt">,</span> i <span class="opt">=</span> <span class="num">72</span><span class="opt">,</span> <span class="num">83</span><span class="opt">),</span> <span class="str">&quot;T&quot;</span><span class="opt">, (</span><span class="str">&quot; &quot;</span><span class="opt">,</span> i <span class="opt">=</span> <span class="num">85</span><span class="opt">,</span> <span class="num">96</span><span class="opt">),  &amp;</span>
       <span class="str">&quot;A&quot;</span><span class="opt">,</span> <span class="str">&quot; &quot;</span><span class="opt">,</span> <span class="str">&quot;C&quot;</span><span class="opt">, (</span><span class="str">&quot; &quot;</span><span class="opt">,</span> i <span class="opt">=</span> <span class="num">100</span><span class="opt">,</span> <span class="num">102</span><span class="opt">),</span> <span class="str">&quot;G&quot;</span><span class="opt">, (</span><span class="str">&quot; &quot;</span><span class="opt">,</span> i <span class="opt">=</span> <span class="num">104</span><span class="opt">,</span> <span class="num">115</span><span class="opt">),</span> <span class="str">&quot;T&quot;</span> <span class="opt">/)</span>

  <span class="kwd">allocate</span><span class="opt">(</span><span class="kwd">buffer</span><span class="opt">(</span>bufferSize<span class="opt">))</span>

  <span class="slc">! Read FASTA file line-by-line, extracting sequence three, and converting to</span>
  <span class="slc">! uppercase.</span>
  <span class="kwa">do</span>
     <span class="kwa">read</span><span class="opt">(*,</span> <span class="str">&quot;(a)&quot;</span><span class="opt">,</span> iostat<span class="opt">=</span>stat<span class="opt">)</span> line
     <span class="kwa">if</span> <span class="opt">(</span>stat <span class="opt">/=</span> <span class="num">0</span><span class="opt">)</span> exit
     <span class="kwa">if</span> <span class="opt">(.</span>not<span class="opt">.</span> atThirdPart<span class="opt">)</span> <span class="kwa">then</span>
        atThirdPart <span class="opt">=</span> <span class="kwd">line</span><span class="opt">(</span><span class="num">1</span><span class="opt">:</span><span class="num">3</span><span class="opt">) ==</span> <span class="str">&quot;&gt;TH&quot;</span>
     <span class="kwa">else</span>
        <span class="kwa">if</span> <span class="opt">(</span>n<span class="opt">+</span>LineLen <span class="opt">&gt;</span> bufferSize<span class="opt">)</span> <span class="kwa">then</span>
           <span class="kwd">allocate</span><span class="opt">(</span><span class="kwd">tempBuffer</span><span class="opt">(</span>bufferSize<span class="opt">))</span>
           tempBuffer <span class="opt">=</span> buffer
           <span class="kwd">deallocate</span><span class="opt">(</span>buffer<span class="opt">)</span>
           <span class="kwd">allocate</span><span class="opt">(</span><span class="kwd">buffer</span><span class="opt">(</span><span class="num">2</span><span class="opt">*</span>bufferSize<span class="opt">))</span>
           <span class="kwd">buffer</span><span class="opt">(</span><span class="num">1</span><span class="opt">:</span>bufferSize<span class="opt">) =</span> tempBuffer
           <span class="kwd">buffer</span><span class="opt">(</span>bufferSize<span class="opt">+</span><span class="num">1</span><span class="opt">:</span><span class="num">2</span><span class="opt">*</span>bufferSize<span class="opt">) =</span> <span class="str">&quot; &quot;</span>
           <span class="kwd">deallocate</span><span class="opt">(</span>tempBuffer<span class="opt">)</span>
           bufferSize <span class="opt">=</span> <span class="num">2</span><span class="opt">*</span>bufferSize
        <span class="kwa">end if</span>
        <span class="kwa">do</span> i <span class="opt">=</span> <span class="num">1</span><span class="opt">,</span> LineLen
           <span class="kwd">buffer</span><span class="opt">(</span>n<span class="opt">+</span>i<span class="opt">) =</span> <span class="kwd">Codes</span><span class="opt">(</span><span class="kwd">iachar</span><span class="opt">(</span><span class="kwd">line</span><span class="opt">(</span>i<span class="opt">:</span>i<span class="opt">)))</span>
        <span class="kwa">end do</span>
        n <span class="opt">=</span> n <span class="opt">+</span> LineLen
     <span class="kwa">end if</span>
  <span class="kwa">end do</span>

  n <span class="opt">=</span> <span class="kwd">minloc</span><span class="opt">(</span><span class="kwd">iachar</span><span class="opt">(</span>buffer<span class="opt">),</span><span class="num">1</span><span class="opt">) -</span> <span class="num">1</span>

  <span class="kwa">call</span> <span class="kwd">init_table</span><span class="opt">(</span>kn<span class="opt">,</span> InitialTableSize<span class="opt">)</span>

  <span class="kwa">call</span> <span class="kwd">write_frequencies</span><span class="opt">(</span><span class="num">1</span><span class="opt">)</span>
  <span class="kwa">call</span> <span class="kwd">write_frequencies</span><span class="opt">(</span><span class="num">2</span><span class="opt">)</span>

  <span class="kwa">call</span> <span class="kwd">write_count</span><span class="opt">(</span><span class="str">&quot;GGT&quot;</span><span class="opt">)</span>
  <span class="kwa">call</span> <span class="kwd">write_count</span><span class="opt">(</span><span class="str">&quot;GGTA&quot;</span><span class="opt">)</span>
  <span class="kwa">call</span> <span class="kwd">write_count</span><span class="opt">(</span><span class="str">&quot;GGTATT&quot;</span><span class="opt">)</span>
  <span class="kwa">call</span> <span class="kwd">write_count</span><span class="opt">(</span><span class="str">&quot;GGTATTTTAATT&quot;</span><span class="opt">)</span>
  <span class="kwa">call</span> <span class="kwd">write_count</span><span class="opt">(</span><span class="str">&quot;GGTATTTTAATTTATAGT&quot;</span><span class="opt">)</span>

<span class="kwa">contains</span>

  <span class="kwa">subroutine</span> <span class="kwd">write_frequencies</span><span class="opt">(</span>length<span class="opt">)</span>
    <span class="kwa">integer</span><span class="opt">,</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">) ::</span> length

    <span class="kwa">integer</span> <span class="opt">::</span> numNuc<span class="opt">,</span> j
    <span class="kwa">type</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">),</span> <span class="kwa">dimension</span><span class="opt">(</span><span class="num">4</span><span class="opt">**</span>length<span class="opt">) ::</span> nucleotides
    <span class="kwa">type</span><span class="opt">(</span><span class="kwa">key</span><span class="opt">) ::</span> temp

    numNuc <span class="opt">=</span> n <span class="opt">-</span> length <span class="opt">+</span> <span class="num">1</span>

    <span class="kwa">call</span> <span class="kwd">read_frame</span><span class="opt">(</span>buffer<span class="opt">,</span> numNuc<span class="opt">,</span> length<span class="opt">,</span> kn<span class="opt">)</span>

    nucleotides <span class="opt">=</span> <span class="kwd">keys_of_given_len</span><span class="opt">(</span>kn<span class="opt">,</span> length<span class="opt">)</span>

    <span class="slc">! Insertion sort</span>
    <span class="kwa">do</span> i <span class="opt">=</span> <span class="num">2</span><span class="opt">,</span> <span class="kwd">size</span><span class="opt">(</span>nucleotides<span class="opt">)</span>
       temp <span class="opt">=</span> <span class="kwd">nucleotides</span><span class="opt">(</span>i<span class="opt">)</span>
       <span class="kwa">do</span> j <span class="opt">=</span> i<span class="opt">,</span> <span class="num">2</span><span class="opt">, -</span><span class="num">1</span>
          <span class="kwa">if</span> <span class="opt">(</span><span class="kwd">nucleotides</span><span class="opt">(</span>j<span class="opt">-</span><span class="num">1</span><span class="opt">)%</span>count <span class="opt">&gt;</span> temp<span class="opt">%</span>count <span class="opt">.</span>or<span class="opt">.  &amp;</span>
               <span class="kwd">nucleotides</span><span class="opt">(</span>j<span class="opt">-</span><span class="num">1</span><span class="opt">)%</span>count <span class="opt">==</span> temp<span class="opt">%</span>count <span class="opt">.</span>and<span class="opt">.  &amp;</span>
               <span class="kwd">nucleotides</span><span class="opt">(</span>j<span class="opt">-</span><span class="num">1</span><span class="opt">)%</span>word <span class="opt">&lt;</span> temp<span class="opt">%</span>word<span class="opt">)</span> exit
          <span class="kwd">nucleotides</span><span class="opt">(</span>j<span class="opt">) =</span> <span class="kwd">nucleotides</span><span class="opt">(</span>j<span class="opt">-</span><span class="num">1</span><span class="opt">)</span>
       <span class="kwa">end do</span>
       <span class="kwd">nucleotides</span><span class="opt">(</span>j<span class="opt">) =</span> temp
    <span class="kwa">end do</span>

    <span class="kwa">do</span> i <span class="opt">=</span> <span class="num">1</span><span class="opt">,</span> <span class="kwd">size</span><span class="opt">(</span>nucleotides<span class="opt">)</span>
       <span class="kwa">write</span><span class="opt">(*,</span> <span class="str">&quot;(a2,f6.3)&quot;</span><span class="opt">)</span> <span class="kwd">nucleotides</span><span class="opt">(</span>i<span class="opt">)%</span><span class="kwd">word</span><span class="opt">(</span><span class="num">1</span><span class="opt">:</span><span class="num">2</span><span class="opt">),  &amp;</span>
            <span class="num">100</span><span class="opt">. *</span> <span class="kwd">nucleotides</span><span class="opt">(</span>i<span class="opt">)%</span>count <span class="opt">/</span> <span class="kwa">real</span><span class="opt">(</span>numNuc<span class="opt">)</span>
    <span class="kwa">end do</span>
    <span class="kwa">write</span><span class="opt">(*,</span> <span class="str">&quot;(a)&quot;</span><span class="opt">)</span> <span class="str">&quot;&quot;</span>
  <span class="kwa">end subroutine</span> write_frequencies

  <span class="kwa">subroutine</span> <span class="kwd">write_count</span><span class="opt">(</span>string<span class="opt">)</span>
    <span class="kwa">character</span><span class="opt">(</span>len<span class="opt">=*),</span> <span class="kwd">intent</span><span class="opt">(</span>in<span class="opt">) ::</span> string

    <span class="kwa">character</span><span class="opt">,</span> <span class="kwa">parameter</span> <span class="opt">::</span> tab <span class="opt">=</span> <span class="kwd">achar</span><span class="opt">(</span><span class="num">9</span><span class="opt">)</span>
    <span class="kwa">integer</span> <span class="opt">::</span> length<span class="opt">,</span> numNuc

    length <span class="opt">=</span> <span class="kwd">len</span><span class="opt">(</span>string<span class="opt">)</span>
    numNuc <span class="opt">=</span> n <span class="opt">-</span> length <span class="opt">+</span> <span class="num">1</span>

    <span class="kwa">call</span> <span class="kwd">read_frame</span><span class="opt">(</span>buffer<span class="opt">,</span> numNuc<span class="opt">,</span> length<span class="opt">,</span> kn<span class="opt">)</span>

    <span class="kwa">write</span><span class="opt">(*,</span> <span class="str">&quot;(i0,a)&quot;</span><span class="opt">)</span> <span class="kwd">cnt</span><span class="opt">(</span>kn<span class="opt">,</span> string<span class="opt">),</span> tab<span class="opt">//</span>string
  <span class="kwa">end subroutine</span> write_count
<span class="kwa">end program</span> knucleotide
    </pre>
  </section>
  <section>
    <h3 id="log">notes, command-line, and program output</h3>
    <pre>
NOTES:
64-bit Ubuntu quad core
Intel(R) Fortran Intel(R) 64 Compiler for applications running on Intel(R) 64, Version 18.0.0.128 Build 20170811
Copyright (C) 1985-2017 Intel Corporation.  All rights reserved.
FOR NON-COMMERCIAL USE ONLY


Thu, 26 Oct 2017 20:38:31 GMT

MAKE:
/opt/src/intel/bin/ifort -O3 -fast -qopenmp knucleotide.f90 -o knucleotide.ifc_run
ipo: warning #11021: unresolved __pthread_create
        Referenced in libpthread.a(pthread_cancel.o)
        Referenced in libpthread.a(pthread_exit.o)
rm knucleotide.f90

0.78s to complete and log all make actions

COMMAND LINE:
./knucleotide.ifc_run 0 &lt; knucleotide-input250000.txt

PROGRAM FAILED 


PROGRAM OUTPUT:

forrtl: severe (174): SIGSEGV, segmentation fault occurred
Image              PC                Routine            Line        Source             
knucleotide.ifc_r  000000000040FA3D  Unknown               Unknown  Unknown
knucleotide.ifc_r  000000000058C6E0  Unknown               Unknown  Unknown
knucleotide.ifc_r  0000000000579705  Unknown               Unknown  Unknown
knucleotide.ifc_r  000000000040E30A  Unknown               Unknown  Unknown
knucleotide.ifc_r  0000000000404F80  Unknown               Unknown  Unknown
knucleotide.ifc_r  000000000040600C  Unknown               Unknown  Unknown
knucleotide.ifc_r  0000000000403BB8  Unknown               Unknown  Unknown
knucleotide.ifc_r  00000000004018D7  Unknown               Unknown  Unknown
knucleotide.ifc_r  0000000000400C8E  Unknown               Unknown  Unknown
knucleotide.ifc_r  000000000058E54A  Unknown               Unknown  Unknown
knucleotide.ifc_r  0000000000400B7A  Unknown               Unknown  Unknown
    </pre>
  </section>
</article>
<footer>
  <nav>
    <ul>
      <li><a href="./license.html"><span>license</span></a>
    </ul>
  </nav>
</footer>

